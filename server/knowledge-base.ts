import { type KnowledgeEntry } from "@shared/schema";

export const knowledgeBase: KnowledgeEntry[] = [
  {
    category: "flora",
    keywords: ["plant", "tree", "vegetation", "species", "flora", "mangrove tree", "rhizophora", "avicennia", "bruguiera", "leaves", "roots", "prop roots", "pneumatophores"],
    answer: "Mangrove forests are home to unique plant species adapted to saltwater environments. Common species include:\n\n• Red Mangroves (Rhizophora) - Known for their distinctive prop roots that arch above water\n• Black Mangroves (Avicennia) - Feature pneumatophores (breathing roots) that stick up from the mud\n• White Mangroves (Laguncularia) - Usually found in higher, drier areas\n\nThese trees have special adaptations like salt-filtering roots, waxy leaves to reduce water loss, and viviparous seeds that germinate while still on the parent tree!"
  },
  {
    category: "flora",
    keywords: ["adapt", "adaptation", "saltwater", "salt", "survive", "grow", "thrive"],
    answer: "Mangrove trees have amazing adaptations to survive in harsh coastal conditions:\n\n• Salt Filtration - Their roots filter out 90% of salt from seawater\n• Salt Excretion - Some species excrete excess salt through special glands in their leaves\n• Vivipary - Seeds germinate while still attached to the parent tree, giving seedlings a head start\n• Aerial Roots - Prop roots and pneumatophores help them breathe in waterlogged soil\n• Thick Leaves - Waxy, succulent leaves store water and reduce moisture loss\n\nThese adaptations make them true survivors in the challenging intertidal zone!"
  },
  {
    category: "fauna",
    keywords: ["animal", "animals", "wildlife", "creature", "fauna", "bird", "birds", "fish", "fishes", "crab", "crabs", "monkey", "monkeys", "crocodile", "crocodiles", "snake", "snakes", "insects", "marine life", "biodiversity", "live in mangrove", "species in mangrove", "mangrove animal", "mangrove wildlife"],
    answer: "Mangrove forests support incredible biodiversity! Common animals include:\n\nCrustaceans - Fiddler crabs, mud crabs, and shrimp thrive in the muddy substrate\nFish - Juvenile fish use mangroves as nurseries (snappers, groupers, barracudas)\nBirds - Herons, egrets, pelicans, and kingfishers hunt and nest here\nReptiles - Saltwater crocodiles, monitor lizards, and mangrove snakes\nMammals - Proboscis monkeys, fishing cats, and otters in some regions\nInsects - Mangrove crabs, mosquitoes, and various beetles\n\nThese ecosystems provide food, shelter, and breeding grounds for thousands of species!"
  },
  {
    category: "fauna",
    keywords: ["proboscis monkey", "monkey", "primate", "endangered"],
    answer: "The proboscis monkey is one of the most iconic mangrove animals! These fascinating primates are found only in Borneo's mangrove and riverine forests. Males are known for their large, bulbous noses and can weigh up to 50 pounds. They're excellent swimmers with partially webbed feet, which helps them navigate mangrove waterways. Sadly, they're endangered due to habitat loss from deforestation and conversion of mangroves to agriculture."
  },
  {
    category: "economic",
    keywords: ["economic", "economy", "money", "value", "timber", "wood", "fishing", "honey", "charcoal", "livelihood", "income", "jobs"],
    answer: "Mangrove forests provide significant economic benefits:\n\nTimber & Wood Products - Construction materials, fuel wood, and charcoal\nFisheries - Nursery grounds support commercial fish and shellfish industries worth billions\nHoney Production - Mangrove honey is a valuable product in many regions\nCoastal Protection - They save billions in damage from storms and erosion (valued at $1+ trillion globally)\nMedicines - Traditional and modern medicines derived from mangrove plants\nEmployment - Support livelihoods for millions of coastal communities\n\nStudies estimate mangroves provide $33,000-$57,000 worth of ecosystem services per hectare annually!"
  },
  {
    category: "economic",
    keywords: ["protect", "protection", "storm", "hurricane", "tsunami", "wave", "erosion", "coastal defense", "barrier"],
    answer: "Mangroves are nature's coastal defense system! They provide crucial protection:\n\nWave Reduction - Dense roots can reduce wave height by 66% over 100 meters\nStorm Surge Buffer - Absorb storm surge energy during hurricanes and typhoons\nTsunami Defense - Helped reduce damage during the 2004 Indian Ocean tsunami\nErosion Prevention - Root systems stabilize shorelines and prevent soil erosion\nEconomic Savings - Prevent billions in property damage annually\n\nOne study found that mangroves prevented $65 billion in flood damages during Hurricane Irma alone!"
  },
  {
    category: "tourism",
    keywords: ["visit", "tourism", "travel", "eco-tourism", "tour", "see", "explore", "vacation", "sightseeing", "photography", "kayak", "boat"],
    answer: "Yes! Mangrove forests offer amazing eco-tourism opportunities:\n\nKayaking & Boat Tours - Paddle through winding waterways to observe wildlife\nPhotography - Capture stunning landscapes and unique wildlife\nBird Watching - Spot rare and migratory bird species\nFishing Tours - Sustainable fishing experiences\nBoardwalk Trails - Many sites have elevated walkways for easy exploration\nSunset Cruises - Enjoy breathtaking views at golden hour\n\nPopular destinations include the Sundarbans (India/Bangladesh), Everglades (USA), and Langkawi (Malaysia). Always choose eco-certified operators who prioritize conservation!"
  },
  {
    category: "tourism",
    keywords: ["where", "location", "country", "place", "find", "famous", "best"],
    answer: "Mangrove forests are found in tropical and subtropical coastal areas worldwide! Famous locations include:\n\nAsia-Pacific:\n• Sundarbans (India/Bangladesh) - Largest mangrove forest, home to Bengal tigers\n• Philippines - Over 1,500 islands with mangrove ecosystems\n• Malaysia & Indonesia - Extensive mangrove coverage\n\nAmericas:\n• Everglades National Park (USA) - Largest US mangrove system\n• Amazon Delta (Brazil) - Unique freshwater mangroves\n• Cuba & Caribbean islands - Pristine mangrove cays\n\nAfrica & Middle East:\n• Madagascar - Fourth largest mangrove area globally\n• East African coast - Kenya, Tanzania, Mozambique\n\nOver 120 countries have mangrove forests!"
  },
  {
    category: "ecological",
    keywords: ["ecological", "ecology", "environment", "ecosystem services", "oxygen", "biodiversity hotspot", "nursery ground", "habitat value", "important", "benefit", "why important"],
    answer: "Mangroves are ecological superstars! Their benefits include:\n\nCarbon Storage - Store 3-5 times more carbon per area than rainforests (\"blue carbon\")\nClimate Regulation - Help mitigate climate change by sequestering CO2\nNursery Habitat - 80% of global fish catches depend on mangroves at some life stage\nNutrient Cycling - Filter pollutants and recycle nutrients from land and sea\nBiodiversity Hotspots - Support thousands of species of plants and animals\nWater Quality - Improve water clarity by trapping sediments\nCoastal Stability - Prevent erosion and build up land through sediment accumulation\n\nThey're among the most productive and biologically diverse ecosystems on Earth!"
  },
  {
    category: "ecological",
    keywords: ["carbon storage", "carbon", "blue carbon", "climate change", "greenhouse gas", "sequester", "co2", "carbon sink", "store carbon", "carbon sequestration", "climate", "climate solution"],
    answer: "Mangroves are incredible carbon sinks - often called \"blue carbon\" ecosystems!\n\nKey facts:\n• Store up to 4 times more carbon per hectare than terrestrial forests\n• Sequester carbon in both biomass (trees) and soil (which can be meters deep)\n• Can store carbon for thousands of years in anaerobic soils\n• Account for 10-15% of coastal sediment carbon storage globally\n• When destroyed, they release massive amounts of stored CO2\n\nProtecting and restoring mangroves is a powerful climate solution - they remove about 34 million tons of CO2 from the atmosphere annually!"
  },
  {
    category: "general",
    keywords: ["what is mangrove", "what are mangrove", "definition", "meaning", "explain mangrove", "describe mangrove"],
    answer: "Mangrove forests are unique coastal ecosystems where salt-tolerant trees and shrubs grow in the intertidal zone between land and sea.\n\nKey characteristics:\nFound in tropical and subtropical regions (between 25°N and 25°S)\nThrive in brackish water (mix of fresh and saltwater)\nGrow in soft, muddy soils with little oxygen\nCover about 137,000 km² globally (declining from 200,000 km² historically)\nForm dense, tangled forests along coastlines, estuaries, and lagoons\n\nThey're one of the world's most threatened ecosystems but also one of the most valuable!"
  },
  {
    category: "general",
    keywords: ["threat", "danger", "destroy", "loss", "deforestation", "problem", "cutting", "disappearing"],
    answer: "Sadly, mangrove forests face serious threats:\n\nMajor Threats:\n• Coastal Development - Converted to resorts, ports, and urban areas\n• Aquaculture - Cleared for shrimp farms and fish ponds (major cause)\n• Agriculture - Replaced by rice paddies and palm oil plantations\n• Logging - Harvested for timber and charcoal\n• Pollution - Oil spills, industrial waste, and plastic accumulation\n• Climate Change - Rising seas and changing temperatures\n\nImpact: We've lost 35% of mangroves in the last 40 years - an area larger than Denmark!\n\nHope: Conservation efforts, restoration projects, and eco-tourism are helping protect remaining forests."
  },
  {
    category: "general",
    keywords: ["restoration", "restore", "replant", "conservation", "protect", "save", "help"],
    answer: "Great question! Mangrove restoration is crucial and growing worldwide:\n\nHow it works:\n• Identify suitable sites with proper hydrology and salinity\n• Plant appropriate native species for the location\n• Use propagules (mangrove seedlings) or nursery-grown saplings\n• Monitor and protect young plants from grazing and erosion\n• Ensure community involvement for long-term success\n\nSuccess stories:\n• Over 5,000 hectares restored in the Philippines\n• Large-scale projects in Indonesia, Vietnam, and Madagascar\n• Community-led initiatives achieving 80-90% survival rates\n\nHow you can help:\n• Support conservation organizations\n• Choose sustainable seafood\n• Reduce plastic use\n• Spread awareness about mangrove importance!"
  }
];

export function findRelevantAnswer(userMessage: string): { answer: string; isRelevant: boolean } {
  const lowerMessage = userMessage.toLowerCase();
  
  const mangroveKeywords = [
    "mangrove", "coastal", "saltwater", "tidal", "estuary", "brackish",
    "flora", "fauna", "plant", "tree", "animal", "bird", "fish", "crab",
    "economic", "tourism", "ecological", "carbon", "climate", "ecosystem",
    "root", "adapt", "species", "forest", "nursery", "biodiversity",
    "protect", "storm", "erosion", "wave", "timber", "honey",
    "ecosystem services", "climate resilience", "blue carbon", "wetland",
    "intertidal", "sequester", "conservation", "habitat", "sustainable",
    "environmental", "nature", "marine", "aquatic", "swamp", "marsh"
  ];
  
  const hasMangroveContext = mangroveKeywords.some(keyword => lowerMessage.includes(keyword));
  
  if (!hasMangroveContext) {
    const offTopicResponses = [
      "I'm sorry, I can only answer questions about mangrove forests. Please ask me something related to mangroves, such as their plants, animals, or ecological importance.",
      "I specialize in mangrove forests! Please ask me about mangrove plants, wildlife, economic benefits, or conservation.",
      "That's outside my area of expertise. I'm here to answer questions about mangrove ecosystems - their flora, fauna, importance, and tourism opportunities!",
      "I'm your mangrove forest guide! Try asking me about mangrove trees, animals, coastal protection, or eco-tourism instead.",
    ];
    
    return {
      answer: offTopicResponses[Math.floor(Math.random() * offTopicResponses.length)],
      isRelevant: false,
    };
  }
  
  let bestMatch: KnowledgeEntry | null = null;
  let highestScore = 0;
  
  for (const entry of knowledgeBase) {
    let score = 0;
    
    for (const keyword of entry.keywords) {
      const keywordLower = keyword.toLowerCase();
      
      if (lowerMessage.includes(keywordLower)) {
        const words = lowerMessage.split(/\s+/);
        
        if (keywordLower.includes(" ")) {
          if (lowerMessage.includes(keywordLower)) {
            score += 5;
          }
        } else if (words.includes(keywordLower)) {
          score += 3;
        } else {
          score += 1;
        }
      }
    }
    
    if (score > highestScore) {
      highestScore = score;
      bestMatch = entry;
    }
  }
  
  if (bestMatch && highestScore > 0) {
    return {
      answer: bestMatch.answer,
      isRelevant: true,
    };
  }
  
  return {
    answer: "That's an interesting question about mangroves! While I don't have specific information about that, I can tell you about mangrove plants, animals, their economic importance, tourism opportunities, or their crucial ecological role. What would you like to know?",
    isRelevant: true,
  };
}

export function getRandomGreeting(): string {
  const greetings = [
    "Hi! I'm MANGO, your Mangrove Forest Chatbot!",
    "Welcome! I'm MANGO, ready to answer your mangrove questions!",
    "Hello! I'm MANGO, your guide to mangrove forests!",
    "Greetings! I'm MANGO, here to share the wonders of mangrove ecosystems!",
  ];
  
  return greetings[Math.floor(Math.random() * greetings.length)];
}

export function getRandomFarewell(): string {
  const farewells = [
    "Goodbye! Thanks for learning about mangroves.",
    "See you later! Keep exploring mangrove forests.",
    "Bye! Hope you enjoyed learning about these amazing ecosystems.",
    "Take care! Remember to protect our precious mangrove forests.",
  ];
  
  return farewells[Math.floor(Math.random() * farewells.length)];
}
